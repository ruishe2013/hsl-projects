DROP DATABASE IF EXISTS `snow-world`;
CREATE DATABASE `snow-world`;
use `snow-world`;

delete from mysql.user where User = 'test123';
grant select,update,delete,insert on `snow-world`.* to 'test123'@'localhost' identified by 'test123';
flush privileges;

DROP TABLE IF EXISTS sw_user_base_user;
create table sw_base_user (
	id bigint primary key auto_increment,
	username varchar(60) not null,
	password varchar(100) not null,
	sex tinyint default 0 not null,
	birth_year smallint default 0 not null,
	real_name varchar(60),
	email varchar(255),
	phone varchar(100),
	career varchar(100),
	qq varchar(50),
	register_ip varchar(100),
	status tinyint default 0 not null,
	deleted tinyint default 0 not null,
	gmt_create datetime not null,
	gmt_modified datetime not null
) ENGINE=INNODB DEFAULT CHARSET=GBK COLLATE=gbk_bin COMMENT='Database privileges';
create index ind_base_user_nick on sw_base_user(username, deleted);


DROP TABLE IF EXISTS sw_area_province;
create table sw_area_province (
	id int primary key auto_increment,
	name varchar(30) not null,
	pinyin varchar(60),
	deleted tinyint default 0 not null,
	gmt_create datetime not null,
	gmt_modified datetime not null
) ENGINE=INNODB DEFAULT CHARSET=GBK COLLATE=gbk_bin COMMENT='Database privileges';



DROP TABLE IF EXISTS sw_area_city;
create table sw_area_city (
	id int primary key auto_increment,
	name varchar(30) not null,
	pinyin varchar(60),
	province_id int default 0 not null,
	deleted tinyint default 0 not null,
	gmt_create datetime not null,
	gmt_modified datetime not null
) ENGINE=INNODB DEFAULT CHARSET=GBK COLLATE=gbk_bin COMMENT='Database privileges';
create index ind_city_prov_id on sw_area_city(province_id, deleted);


DROP TABLE IF EXISTS sw_area_city_ip;
create table sw_area_city_ip (
	id bigint primary key auto_increment,
	city_id int default 0 not null,
	city_name varchar(30) not null,
	ip_end bigint not null,
	ip_start bigint not null,
	deleted tinyint default 0 not null,
	gmt_create datetime not null,
	gmt_modified datetime not null
) ENGINE=INNODB DEFAULT CHARSET=GBK COLLATE=gbk_bin COMMENT='Database privileges';
create index ind_city_ip on sw_area_city_ip(ip_start, ip_end, deleted, gmt_create);


DROP TABLE IF EXISTS sw_order;
create table sw_order (
	id bigint primary key auto_increment,
	city_id int default 0 not null,
	from_addr varchar(100) not null,
	from_time datetime not null,
	from_city varchar(30) not null,
	arrive_addr varchar(100) not null,
	arrive_city varchar(30) not null,
	arrive_time datetime,
	description varchar(1024),
	creator_username varchar(60) not null,
	creator_id bigint not null,
	status int default 0 not null,
	type tinyint default 0 not null,
	total_seats int default 0 not null,
	deleted tinyint default 0 not null,
	gmt_create datetime not null,
	gmt_modified datetime not null
) ENGINE=INNODB DEFAULT CHARSET=GBK COLLATE=gbk_bin COMMENT='Database privileges';
create index ind_city_id on sw_order(city_id, deleted, gmt_modified);


DROP TABLE IF EXISTS sw_order_user;
create table sw_order_user (
	id bigint primary key auto_increment,
	order_id bigint not null,
	user_id bigint not null,
	username varchar(60) not null,
	sex tinyint default 0 not null,
	birth_year smallint default 0 not null,
	real_name varchar(60) not null,
	phone varchar(100) not null,
	email varchar(255),
	career varchar(100),
	qq varchar(50),
	status tinyint default 0 not null,
	order_type tinyint default 0 not null, 
	role tinyint default 0 not null, 
	deleted tinyint default 0 not null,
	gmt_create datetime not null,
	gmt_modified datetime not null
) ENGINE=INNODB DEFAULT CHARSET=GBK COLLATE=gbk_bin COMMENT='Database privileges';
create index ind_ord_u_by_u on sw_order_user(user_id, role, status, deleted);
create index ind_ord_u_by_o on sw_order_user(order_id, status, deleted);
